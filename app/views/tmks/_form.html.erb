
<%= bootstrap_form_for @tmk, layout: :horizontal, label_col: 'col-sm-2', control_col: 'col-sm-6' do |f| %>

    <% if @tmk.errors[:base].present? %>
        <%= f.alert_message 'Favor corrigir o(s) erro(s) abaixo. ' + @tmk.errors[:base][0] %>
    <% else %>
        <%= f.alert_message 'Favor corrigir o(s) erro(s) abaixo.' %>
    <% end %>


    <!-- Contatado -->

    <% if @with_who %>
        <%= hidden_field_tag 'tmk[with_who_id]', @with_who.id %>
        <%= f.static_control nil, label: 'Contatado' do %>
            <%= @with_who.name %>
        <% end %>
    <% else %>
        <%= f.collection_select :with_who_id, Person.all.order('name'), :id, :name,
                                label: 'Contatado', control_col: 'col-sm-3',
                                include_blank: true, default: nil %>
    <% end %>


    <!-- Evento -->

    <% if @event %>
        <%= hidden_field_tag 'tmk[event_id]', @event.id %>
        <%= f.static_control nil, label: 'Evento' do %>
            <%= @event.name %>
        <% end %>
    <% else %>
        <%= render 'common/event_select_field', f: f %>
    <% end %>


    <%= f.collection_select :from_who_id, Person.all.order('name'), :id, :name,
                            label: 'Quem fez contato', control_col: 'col-sm-3',
                            selected: @tmk.persisted? ? @tmk.from_who_id : Person.find_by(email: current_user.email).id %>

    <%= f.select :contact_type, Tmk::CONTACT_TYPES, label: 'Tipo de contato', control_col: 'col-sm-3' %>

    <%= f.text_field :contact_date, label: 'Quando', class: 'datetimepicker',
                     control_col: 'col-sm-3',
                     value: @tmk.persisted? ? @tmk.contact_date.strftime('%Y-%m-%d %H:%M') : Time.now.strftime('%Y-%m-%d %H:%M') %>

    <%= f.text_area :notes, label: 'Notas', rows: 5 %>

    <%= f.form_group do %>
        <%= f.submit 'Salvar' %>
        <%= link_to 'Voltar', session[:last_page], class: 'btn btn-link' %>
    <% end %>

<% end %>
