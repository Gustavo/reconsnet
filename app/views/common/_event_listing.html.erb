<% events = local_assigns.fetch :events, [] %>


<table class="table table-striped">
  <thead>
  <tr>
    <th></th>
    <th></th>
    <% if policy(Participation).show? %>
        <th>Participações</th>
        <th>Participações Acum.</th>
    <% end %>
  </tr>
  </thead>
  <tbody>
  <% part_count = 0 %>
  <% events.each do |event| %>

      <% if event.start.day == event.finish.day %>
          <% date_str = I18n.l event.start, format: '%e %b' %>
      <% elsif event.start.month == event.finish.month %>
          <% date_str = "#{I18n.l event.start, format: '%e'} a #{I18n.l event.finish, format: '%e %b'}" %>
      <% else %>
          <% date_str = "#{I18n.l event.start, format: '%e %b'} a #{I18n.l event.finish, format: '%e %b'}" %>
      <% end %>

      <tr>
        <td><em><%= date_str %></em></td>
        <td><%= link_to event.name, event_path(event) %></td>
        <% if policy(Participation).show? %>
            <td><strong><%= part_num = event.participations.where(status: Participation.statuses[:enrolled]).size; part_num %></strong></td>
            <td><%= part_count += part_num; part_count %></td>
        <% end %>
      </tr>
  <% end %>
  </tbody>
</table>