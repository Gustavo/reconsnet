
<%= render 'common/page_title', titulo: "Evento <em>#{@event.name}</em>".html_safe %>

<% content_for :actions do %>
    <%= render 'common/btn_edit', resource: @event %>
    <%= render 'common/btn_delete', resource: @event %>
<% end %>


<dl class="dl-horizontal">
  <dt>Atividade:</dt>
  <dd><%= activity_link_display @event.activity %></dd>

  <dt>Descrição:</dt>
  <dd><%= @event.description %></dd>

  <dt>Início:</dt>
  <dd><%= date_display @event.start %></dd>

  <dt>Fim:</dt>
  <dd><%= date_display @event.finish %></dd>
</dl>



<!-- Anexos -->

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Anexos
      <div class="pull-right">
        <%= render 'common/btn_add', url: new_asset_path(assetable_id: @event.id,
                                                         assetable_type: 'Event'),
                                     size: 'btn-xs',
                                     resource: Asset.new %>
      </div>
    </h3>
  </div>
  <div class="panel-body">

    <% if @assets.empty? %>

        <small>Sem anexos</small>

    <% else %>

      <% @assets.each do |asset| %>
        <div>
            <span class="glyphicon glyphicon-file"></span>
            <%= asset.name %> <small>(<%= date_display asset.created_at %>)</small>

            <%= link_to asset.file.url, class: 'btn btn-default btn-xs' do %>
                <span class="glyphicon glyphicon-download" title="download"></span>
            <% end %>
            <% if policy(@event).edit? %>
                  <%= render 'common/btn_edit', btn_label: '', url: edit_asset_path(asset,
                                                                                    assetable_id: @event.id,
                                                                                    assetable_type: 'Event'),
                             size: 'btn-xs', resource: asset %>
                  <%= render 'common/btn_delete', btn_label: '', url: asset_path(asset,
                                                                                 assetable_id: @event.id,
                                                                                 assetable_type: 'Event'),
                             size: 'btn-xs', resource: asset %>
            <% end %>
        </div>
      <% end %>

    <% end %>

  </div>
</div>



<!-- Participantes -->

<% if policy(Participation).show? %>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Participantes
      <div class="pull-right">
        <%= render 'common/btn_emails', size: 'btn-xs' %>
        <%= render 'common/btn_add', url: new_event_participation_path(@event.id),
                   size: 'btn-xs', resource: @event %>
      </div>
    </h3>
  </div>
  <div class="panel-body">

    <% if @has_participations %>
        <% lista = [ [@enrolled, 'Inscritos'],
                     [@pre_enrolled, 'Pré-inscritos'],
                     [@interested, 'Interessados'] ] %>

        <% lista.each do |elem| %>
            <% participations = elem[0] %>
            <% label = elem[1] %>
            <h5><%= label %> (<%= participations.size %>)</h5>

            <% if participations.empty? %>
                <small>Não existem <%= label.downcase %> para este evento</small>
            <% else %>
                <% participations.each do |participation| %>
                      <div>
                        <%= link_to participation.person.name, person_path(participation.person.id) %>
                        <em>(<%= participation.participation_type.downcase %>)</em>
                          <% if policy(@event).edit? %>
                            <%= render 'common/btn_edit', url: edit_event_participation_path(@event, participation),
                                       btn_label: '', size: 'btn-xs', resource: participation %>
                            <%= render 'common/btn_delete', url: event_participation_path(@event, participation),
                                       btn_label: '', size: 'btn-xs', resource: participation %>
                          <% end %>
                      </div>
                <% end %>
            <% end %>

        <br>
        <% end %>

    <% else  %>

        Não existem participantes para este evento

    <% end %>
  </div>
</div>
<% end %>




